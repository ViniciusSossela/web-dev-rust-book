# Recommendations

Nesta query, `recommendations`, vamos fazer uma consulta a mesma API anterior, mas em um endpoint diferente. Esse endpoint retorna todas as opções de voo para uma rota (data, origem e destino). Consultaremos a URL de `recommendations` da Latam `https://bff.latam.com/ws/proxy/booking-webapp-bff/v1/public/revenue/recommendations/oneway?departure=<YYYY-mm-dd>&origin=<IATA>&destination=<IATA>&cabin=Y&country=BR&language=PT&home=pt_br&adult=1&promoCode=`, na qual `departure` é a data de partida no formato `ano-mes-dia`, `origin` é o código IATA da cidade ou do aeroporto de origem, `destination` é o código IATA da cidade ou do aeroporto de destino. Assim, nossa query deve receber 3 argumentos `departure`, `origin` e `destination` e retornar uma lista de todas as opções de vôo, além de lançar erros. Assim como a query `bestPrices`, nossa query de `recommendations` vai receber os mesmos parâmetros:

**BestPrices**:
```rust
bestPrices(
    departure: String,
    origin: String,
    destination: String,
) 
```

**Recommendations**:
```rust
recommendations(
    departure: String,
    origin: String,
    destination: String,
) 
```

O tipo de retorno de `recommendations` será semelhante ao tipo de `bestPrices`, `Result<Recommendations, GenericError>`. As validações dos tipos de entrada podem continuar iguais:

```rust
#[juniper::object]
impl QueryRoot {
    fn ping() -> FieldResult<String> {
        Ok(String::from("pong"))
    }

    fn bestPrices(
        departure: String,
        origin: String,
        destination: String,
    ) -> Result<BestPrices, GenericError> {
        error::iata_format(&origin, &destination)?;
        error::departure_date_format(&departure)?;
        let best_price = best_prices_info(departure, origin, destination)?;
        Ok(best_price)
    }

    fn recommendations(
        departure: String,
        origin: String,
        destination: String,
    ) -> Result<Recommendations, GenericError> {
        error::iata_format(&origin, &destination)?;
        error::departure_date_format(&departure)?;
        ...
    }
}
```

Agora podemos começar a implementar o resolver `recommendations_info`, começando por conehcer o endpoint.

## Conhecendo o endpoint de `recommendations`

Consultando o endpoint de `recommendations` para data `"2020-07-21"`, para origem `POA` e para destino `GRU` https://bff.latam.com/ws/proxy/booking-webapp-bff/v1/public/revenue/recommendations/oneway?departure={data}&origin={iata}&destination={iata}&cabin=Y&country=BR&language=PT&home=pt_br&adult=1&promoCode= recebemos o seguinte campos relevantes no Json:

```json
{
  "data":[
    {
      "flights":[
        {
          "flightCode":"LA4596",
          "arrival":{
            "airportCode":"GRU",
            "airportName":"Guarulhos Intl.",
            "cityCode":"SAO",
            "cityName":"São Paulo",
            "countryCode":"BR",
            "date":"2020-07-21",
            "dateTime":"2020-07-21T10:50-03:00",
            "overnights":0,
            "time":{
              "stamp":"10:50",
              "hours":"10",
              "minutes":"50"
            }
          },
          "departure":{
            "airportCode":"POA",
            "airportName":"Salgado Filho",
            "cityCode":"POA",
            "cityName":"Porto Alegre",
            "countryCode":"BR",
            "date":"2020-07-21",
            "dateTime":"2020-07-21T09:15-03:00",
            "overnights":null,
            "time":{
              "stamp":"09:15",
              "hours":"09",
              "minutes":"15"
            }
          },
          "stops":0,
          "segments":[
            {
              "flightCode":"LA4596",
              "flightNumber":"4596",
              "waitTime":null,
              "equipment":{
                "name":"Airbus 321",
                "code":"321"
              },
              "legs":[

              ],
              "airline":{
                "marketing":{
                  "code":"LA",
                  "name":"LATAM Airlines"
                },
                "operating":{
                  "code":"JJ",
                  "name":"LATAM Airlines Brasil"
                },
                "code":"LA"
              },
              "duration":"PT1H35M",
              "departure":{
                "airportCode":"POA",
                "airportName":"Salgado Filho",
                "cityCode":"POA",
                "cityName":"Porto Alegre",
                "countryCode":"BR",
                "date":"2020-07-21",
                "dateTime":"2020-07-21T09:15-03:00",
                "overnights":null,
                "time":{
                  "stamp":"09:15",
                  "hours":"09",
                  "minutes":"15"
                }
              },
              "arrival":{
                "airportCode":"GRU",
                "airportName":"Guarulhos Intl.",
                "cityCode":"SAO",
                "cityName":"São Paulo",
                "countryCode":"BR",
                "date":"2020-07-21",
                "dateTime":"2020-07-21T10:50-03:00",
                "overnights":0,
                "time":{
                  "stamp":"10:50",
                  "hours":"10",
                  "minutes":"50"
                }
              },
              "familiesMap":{
                "Y-LIGHT":{
                  "segmentClass":"G",
                  "farebasis":"GLYX0N1"
                },
                "Y-PLUS":{
                  "segmentClass":"G",
                  "farebasis":"GLYX0N8"
                },
                "Y-TOP":{
                  "segmentClass":"G",
                  "farebasis":"GLYX0N9"
                },
                "W-PLUS":{
                  "segmentClass":"P",
                  "farebasis":"GDKX0N2"
                },
                "W-TOP":{
                  "segmentClass":"W",
                  "farebasis":"XJ7X0NA"
                }
              }
            }
          ],
          "flightDuration":"PT1H35M",
          "cabins":[
            {
              "code":"Y",
              "displayPrice":101.03,
              "availabilityCount":18,
              "displayPrices":{
                "slice":101.03,
                "wholeTrip":101.03,
                "sliceDiscountCode":"",
                "wholeTripDiscountCode":""
              },
              "fares":[
                {
                  "code":"SL",
                  "category":"LIGHT",
                  "fareId":"250/BdC0XLNrp3H333zqIqmJJpNOO/05D8NwB5zcjHVNnkyl4GjqR/YOQrcDNWLPERAtEBLYqieN002",
                  "price":{
                    "adult":{
                      "amountWithoutTax":68.9,
                      "taxAndFees":32.13,
                      "total":101.03
                    }
                  },
                  "pricesPerPassenger":{
                    "adult":{
                      "currency":"BRL",
                      "slice":{
                        "base":68.9,
                        "tax":32.13,
                        "total":101.03
                      },
                      "wholeTrip":{
                        "base":68.9,
                        "tax":32.13,
                        "total":101.03
                      }
                    }
                  },
                  "fareAttributes":{
                    "changeBefore":{
                      "allowed":true,
                      "price":{
                        "amount":68.9,
                        "currency":"BRL"
                      }
                    },
                    "changeAfter":{
                      "allowed":true,
                      "price":{
                        "amount":68.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":false,
                      "price":{
                        "amount":0
                      }
                    },
                    "carryOnBaggage":{
                      "pieces":1,
                      "allowed":true
                    },
                    "checkedBaggage":{
                      "price":{
                        "amount":43,
                        "currency":"BRL"
                      },
                      "allowed":false
                    },
                    "features":[
                      {
                        "code":"050",
                        "value":"CHARGE"
                      },
                      {
                        "code":"05Z",
                        "value":"CHARGE"
                      },
                      {
                        "code":"06X",
                        "value":"FREE"
                      }
                    ]
                  },
                  "branded":true,
                  "visibility":"UNRESTRICTED",
                  "accountCode":"",
                  "availabilityCount":18,
                  "_links":{
                    "bookingDetails":{
                      "href":"/itinerary/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/solution/YOQrcDNWLPERAtEBLYqieN002/booking"
                    },
                    "orderCreation":{
                      "href":"/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/recommendation/YOQrcDNWLPERAtEBLYqieN002/order"
                    }
                  },
                  "normalizedFareAttributes":{
                    "carryOnBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":43,
                        "currency":"BRL"
                      }
                    },
                    "seatSelection":{
                      "allowed":true,
                      "availability":"CHARGE"
                    },
                    "prioritySeat":{
                      "allowed":true,
                      "availability":"CHARGE"
                    },
                    "changeBefore":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":68.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":false,
                      "availability":"DISPLAYED-BUT-NOT-OFFERED"
                    },
                    "accumulation":{
                      "allowed":true,
                      "availability":"FREE",
                      "accumulationRules":{
                        "amount":172,
                        "currency":"PTS",
                        "multiplier":2.5,
                        "applyOnCurrency":"BRL"
                      }
                    }
                  }
                },
                {
                  "code":"SE",
                  "category":"PLUS",
                  "fareId":"250/BdC0XLNrp3H333zqIqmJJpNOO/05D8NwB5zcjHVNnkyl4GjqR/YOQrcDNWLPERAtEBLYqieN009",
                  "price":{
                    "adult":{
                      "amountWithoutTax":123.9,
                      "taxAndFees":32.13,
                      "total":156.03
                    }
                  },
                  "pricesPerPassenger":{
                    "adult":{
                      "currency":"BRL",
                      "slice":{
                        "base":123.9,
                        "tax":32.13,
                        "total":156.03
                      },
                      "wholeTrip":{
                        "base":123.9,
                        "tax":32.13,
                        "total":156.03
                      }
                    }
                  },
                  "fareAttributes":{
                    "changeBefore":{
                      "allowed":true,
                      "price":{
                        "amount":123.9,
                        "currency":"BRL"
                      }
                    },
                    "changeAfter":{
                      "allowed":true,
                      "price":{
                        "amount":123.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "price":{
                        "amount":74.34,
                        "currency":"BRL"
                      },
                      "percentage":40
                    },
                    "carryOnBaggage":{
                      "pieces":1,
                      "allowed":true
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "pieces":1
                    },
                    "features":[
                      {
                        "code":"050",
                        "value":"FREE"
                      },
                      {
                        "code":"05Z",
                        "value":"CHARGE"
                      },
                      {
                        "code":"06X",
                        "value":"FREE"
                      }
                    ]
                  },
                  "branded":true,
                  "visibility":"UNRESTRICTED",
                  "accountCode":"",
                  "availabilityCount":18,
                  "_links":{
                    "bookingDetails":{
                      "href":"/itinerary/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/solution/YOQrcDNWLPERAtEBLYqieN009/booking"
                    },
                    "orderCreation":{
                      "href":"/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/recommendation/YOQrcDNWLPERAtEBLYqieN009/order"
                    }
                  },
                  "normalizedFareAttributes":{
                    "carryOnBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "seatSelection":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "prioritySeat":{
                      "allowed":true,
                      "availability":"CHARGE"
                    },
                    "changeBefore":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":123.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":74.34,
                        "currency":"BRL"
                      },
                      "percentage":40
                    },
                    "accumulation":{
                      "allowed":true,
                      "availability":"FREE",
                      "accumulationRules":{
                        "amount":309,
                        "currency":"PTS",
                        "multiplier":2.5,
                        "applyOnCurrency":"BRL"
                      }
                    }
                  }
                },
                {
                  "code":"SF",
                  "category":"TOP",
                  "fareId":"250/BdC0XLNrp3H333zqIqmJJpNOO/05D8NwB5zcjHVNnkyl4GjqR/YOQrcDNWLPERAtEBLYqieN00C",
                  "price":{
                    "adult":{
                      "amountWithoutTax":193.9,
                      "taxAndFees":32.13,
                      "total":226.03
                    }
                  },
                  "pricesPerPassenger":{
                    "adult":{
                      "currency":"BRL",
                      "slice":{
                        "base":193.9,
                        "tax":32.13,
                        "total":226.03
                      },
                      "wholeTrip":{
                        "base":193.9,
                        "tax":32.13,
                        "total":226.03
                      }
                    }
                  },
                  "fareAttributes":{
                    "changeBefore":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      }
                    },
                    "changeAfter":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      },
                      "percentage":100
                    },
                    "carryOnBaggage":{
                      "pieces":1,
                      "allowed":true
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "pieces":2
                    },
                    "features":[
                      {
                        "code":"050",
                        "value":"FREE"
                      },
                      {
                        "code":"05Z",
                        "value":"FREE"
                      },
                      {
                        "code":"06X",
                        "value":"FREE"
                      }
                    ]
                  },
                  "branded":true,
                  "visibility":"UNRESTRICTED",
                  "accountCode":"",
                  "availabilityCount":18,
                  "_links":{
                    "bookingDetails":{
                      "href":"/itinerary/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/solution/YOQrcDNWLPERAtEBLYqieN00C/booking"
                    },
                    "orderCreation":{
                      "href":"/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/recommendation/YOQrcDNWLPERAtEBLYqieN00C/order"
                    }
                  },
                  "normalizedFareAttributes":{
                    "carryOnBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":2
                    },
                    "seatSelection":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "prioritySeat":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "changeBefore":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "refund":{
                      "allowed":true,
                      "availability":"FREE",
                      "percentage":100
                    },
                    "accumulation":{
                      "allowed":true,
                      "availability":"FREE",
                      "accumulationRules":{
                        "amount":484,
                        "currency":"PTS",
                        "multiplier":2.5,
                        "applyOnCurrency":"BRL"
                      }
                    }
                  }
                }
              ]
            },
            {
              "code":"W",
              "displayPrice":247.03,
              "availabilityCount":9,
              "displayPrices":{
                "slice":247.03,
                "wholeTrip":247.03,
                "sliceDiscountCode":"",
                "wholeTripDiscountCode":""
              },
              "fares":[
                {
                  "code":"RA",
                  "category":"PLUS",
                  "fareId":"250/BdC0XLNrp3H333zqIqmJJpNOO/05D8NwB5zcjHVNnkyl4GjqR/YOQrcDNWLPERAtEBLYqieN00F",
                  "price":{
                    "adult":{
                      "amountWithoutTax":214.9,
                      "taxAndFees":32.13,
                      "total":247.03
                    }
                  },
                  "pricesPerPassenger":{
                    "adult":{
                      "currency":"BRL",
                      "slice":{
                        "base":214.9,
                        "tax":32.13,
                        "total":247.03
                      },
                      "wholeTrip":{
                        "base":214.9,
                        "tax":32.13,
                        "total":247.03
                      }
                    }
                  },
                  "fareAttributes":{
                    "changeBefore":{
                      "allowed":true,
                      "price":{
                        "amount":214.9,
                        "currency":"BRL"
                      }
                    },
                    "changeAfter":{
                      "allowed":true,
                      "price":{
                        "amount":214.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "price":{
                        "amount":128.94,
                        "currency":"BRL"
                      },
                      "percentage":40
                    },
                    "carryOnBaggage":{
                      "pieces":1,
                      "allowed":true
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "pieces":1
                    },
                    "features":[
                      {
                        "code":"050",
                        "value":"FREE"
                      },
                      {
                        "code":"05Z",
                        "value":"FREE"
                      },
                      {
                        "code":"06X",
                        "value":"FREE"
                      }
                    ]
                  },
                  "branded":true,
                  "visibility":"UNRESTRICTED",
                  "accountCode":"",
                  "availabilityCount":9,
                  "_links":{
                    "bookingDetails":{
                      "href":"/itinerary/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/solution/YOQrcDNWLPERAtEBLYqieN00F/booking"
                    },
                    "orderCreation":{
                      "href":"/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/recommendation/YOQrcDNWLPERAtEBLYqieN00F/order"
                    }
                  },
                  "normalizedFareAttributes":{
                    "carryOnBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "seatSelection":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "prioritySeat":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "changeBefore":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":214.9,
                        "currency":"BRL"
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "availability":"CHARGE",
                      "price":{
                        "amount":128.94,
                        "currency":"BRL"
                      },
                      "percentage":40
                    },
                    "accumulation":{
                      "allowed":true,
                      "availability":"FREE",
                      "accumulationRules":{
                        "amount":537,
                        "currency":"PTS",
                        "multiplier":2.5,
                        "applyOnCurrency":"BRL"
                      }
                    }
                  }
                },
                {
                  "code":"RY",
                  "category":"TOP",
                  "fareId":"250/BdC0XLNrp3H333zqIqmJJpNOO/05D8NwB5zcjHVNnkyl4GjqR/YOQrcDNWLPERAtEBLYqieN00K",
                  "price":{
                    "adult":{
                      "amountWithoutTax":673.9,
                      "taxAndFees":32.13,
                      "total":706.03
                    }
                  },
                  "pricesPerPassenger":{
                    "adult":{
                      "currency":"BRL",
                      "slice":{
                        "base":673.9,
                        "tax":32.13,
                        "total":706.03
                      },
                      "wholeTrip":{
                        "base":673.9,
                        "tax":32.13,
                        "total":706.03
                      }
                    }
                  },
                  "fareAttributes":{
                    "changeBefore":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      }
                    },
                    "changeAfter":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      }
                    },
                    "refund":{
                      "allowed":true,
                      "price":{
                        "amount":0
                      },
                      "percentage":100
                    },
                    "carryOnBaggage":{
                      "pieces":1,
                      "allowed":true
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "pieces":3
                    },
                    "features":[
                      {
                        "code":"050",
                        "value":"FREE"
                      },
                      {
                        "code":"05Z",
                        "value":"FREE"
                      },
                      {
                        "code":"06X",
                        "value":"FREE"
                      }
                    ]
                  },
                  "branded":true,
                  "visibility":"UNRESTRICTED",
                  "accountCode":"",
                  "availabilityCount":12,
                  "_links":{
                    "bookingDetails":{
                      "href":"/itinerary/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/solution/YOQrcDNWLPERAtEBLYqieN00K/booking"
                    },
                    "orderCreation":{
                      "href":"/search/MTswOzA7UFRfQlI7WTs7O1BPQUdSVTIwMjAwNzIx/result/QmRDMFhMTnJwM0gzMzN6cUlxbUpKcE5PT3wwNUQ4TndCNXpjakhWTm5reWw0R2pxUg==/recommendation/YOQrcDNWLPERAtEBLYqieN00K/order"
                    }
                  },
                  "normalizedFareAttributes":{
                    "carryOnBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":1
                    },
                    "checkedBaggage":{
                      "allowed":true,
                      "availability":"FREE",
                      "pieces":3
                    },
                    "seatSelection":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "prioritySeat":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "changeBefore":{
                      "allowed":true,
                      "availability":"FREE"
                    },
                    "refund":{
                      "allowed":true,
                      "availability":"FREE",
                      "percentage":100
                    },
                    "accumulation":{
                      "allowed":true,
                      "availability":"FREE",
                      "accumulationRules":{
                        "amount":1684,
                        "currency":"PTS",
                        "multiplier":2.5,
                        "applyOnCurrency":"BRL"
                      }
                    }
                  }
                }
              ]
            }
          ]
        },
        ...Mais recomendações aqui
      ],
      "currency":"BRL",
      "recommendedFlightCode":"LA4596",
      "type":"revenue-oneway"
    }
  ],
  "status":{
    "code":200,
    "message":""
  }
}
```